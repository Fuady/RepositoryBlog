---
title: Visualisasi dengan ggplot2
banner: img/banners/Rplot_ggplot2.png
author: A.M.Fuady
date: '2019-11-20'
slug: visualisasi-dengan-ggplot2
categories: 
  - R
tags:
  - R
  - ggplot2
  - visualization
---


Tulisan ini akan membahas mengenai bagaimana cara menyajikan data secara visual menggunakan package __ggplot2__. R memiliki beberapa system untuk membuat visualisasi, namun __ggplot2__ merupakan salah satu package yang sering digunakan untuk menyajikan data.

Sebelum kita mulai, dalam tulisan kali ini saya akan menggunakan dataset *mpg* yang berada di package __ggplot2__. Dataset ini memuat kumpulan observasi dari 38 model mobil. Tentunya kita juga perlu memuat package __ggplot2__ sebagai berikut:

```{r, warning=FALSE}
# install package bila diperlukan
#install.packages("ggplot2")

# load package
library(ggplot2)
```

Berikut ini adalah enam observasi teratas dan ringkasan dari data *mpg*:

```{r}
head(mpg)
summary(mpg)
```

Berikut adalah deskripsi dari setiap variable dalam data *mpg*:

Variable       | Type      | Deskripsi       | Detail
-------------- | --------- | ------------------- | ------------------------
`manufacturer` | String    | Pabrikan mobil  | 15 Pabrikan
`model`        | String    | Model mobil     | 38 Model
`displ`        | Numeric   | Ukuran mesin    | 1.6 - 7.0 liter
`year`         | Integer   | Tahun pembuatan | 1999, 2008
`cyl`          | Integer   | Jumlah silinder | 4,5,6,8
`trans`        | String    | Type transmisi  | automatic, manual
`drv`          | String    | Pergerakan roda | f (front-wheel drive), r (rear wheel drive), 4 (4wd) 
`cty`          | Integer   |Efisiensi bahan bakar di dalam kota | miles per galon
`hwy`          | Integer   | Efisiensi bahan bakar di tol | miles per galon
`fl`           | String    | Type bahan bakar| 5 Type
`class`        | String    | Type mobil      | 7 Type


## Scatterplot

Pada bagian ini, kita akan membuat scatterplot antara `displ` dan `hwy`. 

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

Pembuatan plot dimulai dari membentuk kordinat sistem dengan menggunakan fungsi `ggplot()`, lalu ditumpuk dengan beberapa lapisan/layer. Dalam contoh diatas, `ggplot(data = mpg)` berarti kita akan membuat kordinat sistem menggunakan dataset *mpg* (masih grafik kosong). Lalu kita menambahkan lapisan `geom_point()` untuk membuat scatterplot. Setiap fungsi geom di ggplot2 memiliki argumen `mapping` yang selalu berpasangan dengan `aes()` atau aesthetic yang memetakan `displ` ke sumbu-x dan `hwy`ke sumbu-y.

Kita bisa menambahkan beberapa variable ke dalam scatterplot diatas, misalnya kita ingin mengetahui type mobil (`class`) mana saja yang ada di scatterplot diatas dan tiap type mobil dibedakan berdasarkan warna. Maka kita bisa menambahkan `color=class` ke dalam `aes()`, menjadi sebagai berikut

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```

Jika kita mengganti `color=class` dengan `size=class`, maka pembedaan type mobil divisualkan dengan ukuran plotnya

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
```

Jika kita mengganti `color=class` dengan `shape=class`, maka type mobil dibedakan dengan bentuk plotnya

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

### Facets
Selain dengan menambahkan variable ke dalam `aes()`, khusus untuk categorical variable, kita bisa membagi scatterplot untuk tiap type mobil dengan menggunakan `facet`. Untuk membagi scatterplot dengan satu variable, kita bisa menggunakan `facet_wrap()` sebagai berikut

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) +
  facet_wrap(~class, ncol = 4)
```

Pada plot diatas, scatterplot dibagi untuk tiap type mobil berdasarkan `class`. Disini, subplot disajikan dengan maksimum 4 kolom. 

Facet juga bisa digunakan untuk dua categorical variable, misal kita ingin melihat scatterplot berdasarkan jumlah silinder `cyl` dan pergerakan roda `drv`. Hal ini bisa dilakukan dengan menambahkan `facet_grid()` sebagai berikut

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(cyl ~ drv)
```

### Penambahan garis
Misal, kita ingin menambahkan smooth line ke dalam scatterplot yang telah dibuat diatas. Hal ini bisa dilakukan dengan menambah lapisan `geom_smooth()` ke fungsi `ggplot()`. 

```{r}

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue") +
  geom_smooth(mapping = aes(x = displ, y = hwy), method = "loess", se=FALSE, color="blue" )

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "darkgreen") +
  geom_smooth(mapping = aes(x = displ, y = hwy), method = "lm", se=TRUE, color="darkgreen" )

```

Pada panel pertama, smooth line dengan methode loess `method=loess` digunakan untuk fit data, untuk plot ini confidence interval tidak ditampilkan `se=FALSE`. Untuk panel kedua, kita menggunakan metode linear model `method=lm`dan confidence interval ditampilkan `se=TRUE`. Kita juga bisa memilih warna secara manual dengan mengeset `color="blue"` atau `color="darkgreen"`. 

`geom_smooth()`dapat juga digunakan untuk group yang berbeda, misal kita ingin melihat smooth line dari mobil berdasarkan type pergerakan roda

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "steelblue") +
  geom_smooth(mapping = aes(x = displ, y = hwy, color = drv), method = "loess", se=TRUE) 
```

Gambar diatas menampilkan scatterplot beserta smooth line untuk tiap type pergerakan roda. 


## Bar chart

Pada bagian ini, kita akan membuat bar chart untuk jumlah mobil pada tiap pabrikan dengan menggunakan `geom_bar()`

```{r}
ggplot(data = mpg) + 
  geom_bar(mapping = aes(x=manufacturer, fill = class)) +
  coord_flip()
```
Barchart diatas menampilkan jumlah mobil untuk tiap pabrikan. Kita bisa mewarnai isi dari bar nya dengan menggunakan `fill=class`. Untuk grafik diatas warna berdasarkan type mobilnya. Setingan awal untuk barchart diatas adalah manufacturer berada di sumbu-x, namun kita putar 90 derajat agar nama dari tiap pabrikan terbaca jelas. Flip grafik ini diakomodasi oleh `coord_flip()`. Jika tidak di flip maka tulisan pabrikan akan saling menumpuk.


## Label

```{r, message = FALSE}
ggplot(mpg) +
  geom_point(aes(x = displ, y = hwy, color = class)) +
  geom_smooth(aes(x = displ, y = hwy), se = TRUE) +
  labs(
    title = "Efisiensi bahan bakar menurun sesuai dengan ukuran mesin",
    subtitle = "Pengecualian untuk two seaters (sports cars) karena bobot yang ringan",
    caption = "Data dari fueleconomy.gov",
    x = "Ukuran mesin (L)",
    y = "Efisiensi bahan bakar di dalam tol (mpg)",
    colour = "Type mobil")
```

Kita bisa mengubah dan juga menambahkan beberapa label ke dalam suatu plot dengan menggunakan `labs()`. Untuk grafik diatas, kita menambahkan judul (`title`), subjudul (`subtitle`) yang memiliki ukuran huruf lebih kecil dari judul, serta `caption` yang berada di kanan bawah plot biasanya digunakan untuk mencantumkan sumber data. Selain itu kita juga mengubah beberapa label seperti label sumbu-x, sumbu-y, dan warna label type mobil. 

Kita juga bisa mengganti label plot dengan menggunakan persamaan matematika. hal ini bisa dilakukan dengan mengganti `""` dengan `quote()` seperti contoh dibawah ini. Info lebih lanjut bisa dilihat di `?plotmath`.  

```{r}
df <- data.frame(
  x = runif(50),
  y = runif(50)
)
ggplot(df) +
  geom_point(aes(x, y)) +
  labs(
    x = quote(sum(x[i] ^ 2, i == 1, n)),
    y = quote(alpha + beta + frac(delta, theta))
  )
```




## Penutup
Tulisan ini memuat langkah awal dalam menyajikan data secara visual dengan menggunakan R package **ggplot2**. Penyajian data berupa scatterplot dan barplot dibahas dalam tulisan ini. Selain itu, pembahasan tentang penyajian data khusus untuk categorical variable juga dilakukan. Penambahan serta pengubahan label untuk sebuah plot juga disajikan. Tulisan ini hanya sebagai dasar untuk membuat visualisasi dengan **ggplot2**, tentunya masih banyak lagi fungsi dan grafik yang bisa digunakan. 

Terimakasih telah membaca tulisan ini!

### Cheat sheet
Teman-teman bisa melihat [cheatsheet](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf) dari **ggplot2** untuk informasi yang lebih lengkap. 

### Referensi 
**R for Data Science: Import, Tidy, Transform, Visualize, and Model Data. Hadley Wickham and Garrett Grolemund**