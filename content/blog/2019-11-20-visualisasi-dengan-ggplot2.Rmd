---
title: Data visualization using ggplot2
banner: img/banners/SAM_0931.jpg
author: A.M.Fuady
date: '2019-10-06'
slug: data-visualization-using-ggplot2
categories: 
  - R
tags:
  - R
  - ggplot2
  - visualization
---


This post will discuss how to visualize data using the __ggplot2__ package. R has several systems for creating visualizations, but __ggplot2__ is a package that is often used to present data.

Before we begin, in this article I will use the *mpg* dataset in the __ggplot2__ package. This dataset contains a collection of observations from 38 car models. Of course, first of all, we need to load the __ggplot2__ package as follows:

```{r, warning=FALSE}
# install package bila diperlukan
#install.packages("ggplot2")

# load package
library(ggplot2)
```

The top six observations and summaries of * mpg * data are presented as follows:

```{r}
head(mpg)
summary(mpg)
```

Following is a description of each variable in the *mpg* data:

Variable       | Type      | Descriptions               | Detail
-------------- | --------- | -------------------------- | ------------------------
`manufacturer` | String    | Car manufacturer           | 15 manufacturers
`model`        | String    | Car model                  | 38 Models
`displ`        | Numeric   | Engine displacement        | 1.6 - 7.0 liter
`year`         | Integer   | Year of manufacture        | 1999, 2008
`cyl`          | Integer   | Number of cylinders        | 4,5,6,8
`trans`        | String    | Type of transmission       | automatic, manual
`drv`          | String    | Drivetrain                 | f (front-wheel drive), r (rear wheel drive), 4 (4wd) 
`cty`          | Integer   | Fuel efficiency in city    | miles per galon
`hwy`          | Integer   | Fuel efficiency in highway | miles per galon
`fl`           | String    | Fuel type                  | 5 Type
`class`        | String    | Car type                   | 7 Type


## Scatterplot

In this section, we will create a scatterplot between `displ` and` hwy`.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

Plotting begins by creating the system coordinate using the `ggplot ()` function, then stacking it with several layers. In the example above, `ggplot (data = mpg)` means we will make the system coordinates using the * mpg * dataset (still an empty graph). Then we add the `geom_point ()` layer to create a scatterplot. Each geom function in ggplot2 has a `mapping` argument which is always paired with `aes ()` or aesthetic which maps` displ` to the x-axis and `hwy` to the y-axis.

We can add several variables to the scatterplot above, for example, we want to find out which type of car (`class`) is in the scatterplot above and each type of car is distinguished by color. Then we can add `color = class` to `aes()`, as follows

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```

If we replace `color = class` with` size = class`, then the difference in car type is visualized by the plot size

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
```

If we replace `color = class` with` shape = class`, then the type of car is distinguished by the shape of the plot

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

### Facets
Besides adding variables to `aes ()`, specifically for categorical variables, we can divide scatterplots for each type of car using `facet`. To divide a scatterplot with one variable, we can use `facet_wrap()` as follows

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) +
  facet_wrap(~class, ncol = 4)
```

In the plot above, scatterplots are divided for each type of car based on `class`. Here, subplots are presented with a maximum of 4 columns.

Facets can also be used for two categorical variables, for example, we want to see scatterplots based on the number of cylinders `cyl` and the movement of the` drv` wheels. This can be done by adding `facet_grid ()` as follows

```{r, warning=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(cyl ~ drv)
```

### Addition of lines
Suppose, we want to add a smooth line to the scatterplot that was created above. This can be done by adding the `geom_smooth ()` layer to the `ggplot ()` function.

```{r}

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue") +
  geom_smooth(mapping = aes(x = displ, y = hwy), method = "loess", se=FALSE, color="blue" )

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "darkgreen") +
  geom_smooth(mapping = aes(x = displ, y = hwy), method = "lm", se=TRUE, color="darkgreen" )

```

In the first panel, the smooth line with the method loess `method = loess` is used to fit data, for this plot the confidence interval is not displayed `se = FALSE`. For the second panel, we use the linear model `method = lm` method and the confidence interval is displayed `se = TRUE`. We can also choose colors manually by setting `color = "blue"` or `color = "darkgreen"`.

`geom_smooth ()` can also be used for different groups, for instance, we want to see the smooth line of the car based on the type of wheel movement.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "steelblue") +
  geom_smooth(mapping = aes(x = displ, y = hwy, color = drv), method = "loess", se=TRUE) 
```

The picture above shows a scatterplot along with a smooth line for each type of wheel movement.


## bar chart

In this section, we will create a bar chart for the number of cars in each manufacturer by using `geom_bar ()`

```{r}
ggplot(data = mpg) + 
  geom_bar(mapping = aes(x=manufacturer, fill = class)) +
  coord_flip()
```

The bar chart above shows the number of cars for each manufacturer. We can color the contents of the bar using `fill = class`. For the above color chart based on the type of car, The initial setting for the bar chart above is the manufacturer is on the x-axis, but we rotate it 90 degrees so that the name of each manufacturer can be read clearly. This flip graph is accommodated by `coord_flip ()`. If it is not folded, the manufacturer's writing will overlap.


## Label

```{r, message = FALSE}
ggplot (mpg) +
  geom_point (aes (x = displ, y = hwy, color = class)) +
  geom_smooth (aes (x = displ, y = hwy), se = FALSE) +
  labs (
    title = "Fuel efficiency decreases according to engine size",
    subtitle = "Exceptions for two seaters (sports cars) because of their light weight",
    caption = "Data from fueleconomy.gov",
    x = "Engine displacement (L)",
    y = "Fuel efficiency in highway (mpg)",
    color = "Car type")
```

We can change and also add labels to a plot using `labs()`. For the graph above, we add a title (`title`), a subtitle (` subtitle`) that has a smaller font size than the title, and `caption` located at the bottom right of the plot is usually used to specify the data source. In addition, we also changed some labels such as the x-axis, y-axis, and car type label colors.

We can also replace plot labels by using mathematical equations. this can be done by replacing `""` with `quote ()` as in the example below. More information can be seen in `?Plotmath`.

```{r}
df <- data.frame(
  x = runif(50),
  y = runif(50)
)
ggplot(df) +
  geom_point(aes(x, y)) +
  labs(
    x = quote(sum(x[i] ^ 2, i == 1, n)),
    y = quote(alpha + beta + frac(delta, theta))
  )
```


## Conclusion

This post contains the initial steps in presenting data visually using the R package **ggplot2**. Presentation of data in the form of scatterplots and bar charts are discussed in this post. In addition, visualization of categorical data is also presented. Adding and changing labels for a plot is discussed. This post is only as a basis for making visualizations with ** ggplot2 **, of course there are many more functions and graphics that can be used.

Thank you for reading this article!

### Cheat sheet
You can see [cheatsheet](https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf) from **ggplot2** for more complete information.

### References
** R for Data Science: Import, Tidy, Transform, Visualize, and Model Data. Hadley Wickham and Garrett Grolemund **
